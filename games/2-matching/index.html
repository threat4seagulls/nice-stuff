<!DOCTYPE html>
<meta charset="utf-8"/>
<title>2Matching</title>
<script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"> </script>
<script type="text/javascript" src="node_modules/handlebars/dist/handlebars.min.js"> </script>

<link rel="stylesheet" href="css/bundle.min.css"/>

<div class="layout">
	<h1> Find all matching Pusheens! </h1>
	<div id="control-panel"> </div>
	<div id="gamefield"> </div>
</div>


<script id="control-panel-template" type="text/x-handlebars-template">
	<div id="timer"> Time: 0.0.0 </div>
	{{#each data}}
	<div class="complexity-holder" id="{{num}}" onclick="changeComplexity($(this));">
		<div class="complexity-item" >{{num}} tiles:</div>
		<div class="complexity-best"> {{record}} </div>
	</div>
	{{/each}}
	<div id="restart" onclick="restartGame($(this));"> Restart </div>
</script>


<script id="gamefield-template" type="text/x-handlebars-template">
	{{#each images}}
		<div class="tile-row">
		{{#each this}}
			<div class="tile" id="{{id}}" onclick="clickedTile($(this));">
				<img class="img" src="{{src}}"/><img class="cover" src="pusheen/cover.jpg"/>
			</div>
		{{/each}}
		</div>
	{{/each}}

</script>


<script> 

var timer, tileOpened;
var defaultNumber = 8;

function initGamefield(number) {

	function generateImages(number) {
		function shuffle(o){
			for(var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
			return o;
		}

		var imgNumbers = [], images=[];
		for (var i=0;i<number;i++)
			for (var j=0;j<number/2;j++) {
				imgNumbers.push(j*number+i+1);			
				imgNumbers.push(j*number+i+1);			
			}
		imgNumbers = shuffle(imgNumbers);
		for (var i=0;i<number;i++) {
			images.push([]);			
			for (var j=0;j<number;j++) {
				images[i].push({src:'pusheen/'+(imgNumbers[j*number+i]).toString()+'.jpg', id: (imgNumbers[j*number+i]).toString()+':'+(j*number+i).toString()});
			}
		}
		return images;
	}

	var images = generateImages(number);
	var template = Handlebars.compile($('#gamefield-template').html());
	var html = template({images: images});
	$('#gamefield').html(html);	
}

function initControlPanel(data) {
	var template = Handlebars.compile($('#control-panel-template').html());
	var html = template({data: data});
	$('#control-panel').html(html);	
}


function changeComplexity(elem) {
	elems = $('.complexity-holder');
		for (var i=0;i<elems.length;i++)
			if ($(elems[i]).hasClass("current")) $(elems[i]).removeClass("current");
	$(elem).addClass('current');
	initGamefield(parseInt($(elem).attr("id")));
}

function clickedTile(elem) {
	$(elem).toggleClass("selected");
	console.log($(elem).attr("id"));
}

function restartGame() {
	console.log("restart");
}

$(document).ready(function() {

	initControlPanel([{'num':2, 'record': '0.0.0'}, {'num':4, 'record': '0.0.0'}, {'num':6, 'record': '0.0.0'}, {'num':8, 'record': '0.0.0'}]);
	initGamefield(defaultNumber);

});


</script>